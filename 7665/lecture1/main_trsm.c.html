<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>~/Documents/repositories/langou.github.io.git/7665/lecture1/main_trsm.c.html</title>
<meta name="Generator" content="Vim/9.1">
<meta name="plugin-version" content="vim9.0_v2">
<meta name="syntax" content="c">
<meta name="settings" content="use_css,no_foldcolumn,pre_wrap,prevent_copy=,use_input_for_pc=none">
<meta name="colorscheme" content="default">
<style>
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #000000; background-color: #ffffff; }
body { font-family: monospace; color: #000000; background-color: #ffffff; }
* { font-size: 1em; }
a { color: inherit; }
.Statement { color: #a52a2a; font-weight: bold; }
.Type { color: #2e8b57; font-weight: bold; }
.Constant { color: #ff00ff; }
.Comment { color: #0000ff; }
.PreProc { color: #6a0dad; }
.Special { color: #6a5acd; }
-->
</style>
</head>
<body>
<pre id='vimCodeElement'>
<span class="PreProc">#include </span><span class="Constant">&lt;stdlib.h&gt;</span>
<span class="PreProc">#include </span><span class="Constant">&lt;stdio.h&gt;</span>
<span class="PreProc">#include </span><span class="Constant">&lt;string.h&gt;</span>
<span class="PreProc">#include </span><span class="Constant">&lt;math.h&gt;</span>
<span class="PreProc">#include </span><span class="Constant">&lt;time.h&gt;</span>


<span class="Type">int</span> main(<span class="Type">int</span> argc, <span class="Type">char</span> ** argv) {

	<span class="Type">int</span> i, j, k, m, n;
	<span class="Type">double</span> *A, *X;
	<span class="Type">double</span> normA, normR, tmp;

	srand(<span class="Constant">0</span>);

    	m = <span class="Constant">20</span>;
    	n = <span class="Constant">10</span>;

	<span class="Statement">for</span>(i = <span class="Constant">1</span>; i &lt; argc; i++){
		<span class="Statement">if</span>( strcmp( *(argv + i), <span class="Constant">&quot;-m&quot;</span>) == <span class="Constant">0</span>) {
			m  = atoi( *(argv + i + <span class="Constant">1</span>) );
			i++;
		}
	}

	<span class="Statement">for</span>(i = <span class="Constant">1</span>; i &lt; argc; i++){
		<span class="Statement">if</span>( strcmp( *(argv + i), <span class="Constant">&quot;-n&quot;</span>) == <span class="Constant">0</span>) {
			n  = atoi( *(argv + i + <span class="Constant">1</span>) );
			i++;
		}
	}

	A = (<span class="Type">double</span> *) malloc( m * m * <span class="Statement">sizeof</span>(<span class="Type">double</span>));
 	<span class="Statement">for</span>(j = <span class="Constant">0</span>; j &lt; m; j++){
 		<span class="Statement">for</span>(i = <span class="Constant">0</span>; i &lt; m; i++){
			A[i+j*m] = (<span class="Type">double</span>)rand() / (<span class="Type">double</span>)(<span class="Constant">RAND_MAX</span>) - <span class="Constant">0.5e+00</span>;
		}
	}

	X = (<span class="Type">double</span> *) malloc( m * n * <span class="Statement">sizeof</span>(<span class="Type">double</span>));
 	<span class="Statement">for</span>(k = <span class="Constant">0</span>; k &lt; n; k++){
 		<span class="Statement">for</span>(i = <span class="Constant">0</span>; i &lt; m; i++){
			X[i+k*m] = (<span class="Type">double</span>)rand() / (<span class="Type">double</span>)(<span class="Constant">RAND_MAX</span>) - <span class="Constant">0.5e+00</span>;
		}
	}


	<span class="Type">struct</span> timespec start, end;
	clock_gettime(CLOCK_MONOTONIC, &amp;start);

	<span class="Statement">for</span> ( j = <span class="Constant">0</span> ; j &lt; m ; j++ ){
 		<span class="Statement">for</span>(k = <span class="Constant">0</span>; k &lt; n; k++) X[j+k*m] = X[j+k*m] / A[j+j*m];
		<span class="Statement">for</span> ( i = j+<span class="Constant">1</span> ; i &lt; m ; i++ ){
 			<span class="Statement">for</span>(k = <span class="Constant">0</span>; k &lt; n; k++) X[i+k*m] -= A[i+j*n] * X[j+k*m];
	}
	}

	clock_gettime(CLOCK_MONOTONIC, &amp;end);

<span class="Comment">/*</span>
<span class="Comment">//      </span>
<span class="Comment">//      I need to write a check here</span>
<span class="Comment">//</span>
<span class="Comment">	normR = 0e+00;</span>
<span class="Comment">	for (j = 0; j &lt; n; j++) {</span>
<span class="Comment">		for (i = j; i &lt; n; i++) {</span>
<span class="Comment">			tmp = B[i][j];</span>
<span class="Comment">			for (k = 0; k &lt;= j; k++) {</span>
<span class="Comment">				tmp -= A[i][k]*A[j][k];</span>
<span class="Comment">			}</span>
<span class="Comment">			normR += ( ( i == j ) ? 1.0e+00 : 2.00e+00 ) * tmp * tmp;</span>
<span class="Comment">		}</span>
<span class="Comment">	}</span>
<span class="Comment">	normR = sqrt( normR );</span>
<span class="Comment">*/</span>

	<span class="Type">double</span> time_taken;
	time_taken = end.tv_sec - start.tv_sec;
	time_taken = time_taken + (end.tv_nsec - start.tv_nsec) * <span class="Constant">1e-9</span>;

	<span class="Type">double</span> perf = ((<span class="Type">double</span>) m)*((<span class="Type">double</span>) m)*((<span class="Type">double</span>) n)/time_taken*<span class="Constant">1e-9</span>;

	printf(<span class="Constant">&quot;[ TRSM ] m = </span><span class="Special">%5d</span><span class="Constant">, n = </span><span class="Special">%5d</span><span class="Constant">, time = </span><span class="Special">%8.4f</span><span class="Constant"> (sec), perf = </span><span class="Special">%6.2f</span><span class="Constant"> (GFlops/sec)</span><span class="Special">\n</span><span class="Constant">&quot;</span>, m, n, time_taken, perf);

	free( X );
	free( A );

	<span class="Statement">return</span> <span class="Constant">0</span>;
}
</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
